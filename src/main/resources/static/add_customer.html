<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Add Customer</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <h2>Add Customer</h2>
    <form id="customerForm">
        <input type="hidden" id="customerId" name="customerId">
        <div>
            <label for="first_name">First Name:</label>
            <input type="text" id="first_name" name="first_name" required>
        </div>
        <div>
            <label for="last_name">Last Name:</label>
            <input type="text" id="last_name" name="last_name" required>
        </div>
        <div>
            <label for="street">Street:</label>
            <input type="text" id="street" name="street" required>
        </div>
        <div>
            <label for="address">Address:</label>
            <input type="text" id="address" name="address" required>
        </div>
        <div>
            <label for="city">City:</label>
            <input type="text" id="city" name="city" required>
        </div>
        <div>
            <label for="state">State:</label>
            <input type="text" id="state" name="state" required>
        </div>
        <div>
            <label for="email">Email:</label>
            <input type="email" id="email" name="email" required>
        </div>
        <div>
            <label for="phone">Phone:</label>
            <input type="tel" id="phone" name="phone" required>
        </div>
        <button type="submit">Save</button>
    </form>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const token = localStorage.getItem('jwtToken');
            if (!token) {
                alert('You are not logged in');
                window.location.href = 'login.html';
                return;
            }

            const urlParams = new URLSearchParams(window.location.search);
            const customerId = urlParams.get('id');

            if (customerId) {
                fetch(`/api/customers/${customerId}`, {
                    method: 'GET',
                    headers: {
                        'Authorization': token
                    }
                })
                .then(response => response.json())
                .then(customer => {
                    document.getElementById('customerId').value = customer.id;
                    document.getElementById('first_name').value = customer.first_name;
                    document.getElementById('last_name').value = customer.last_name;
                    document.getElementById('street').value = customer.street;
                    document.getElementById('address').value = customer.address;
                    document.getElementById('city').value = customer.city;
                    document.getElementById('state').value = customer.state;
                    document.getElementById('email').value = customer.email;
                    document.getElementById('phone').value = customer.phone;
                });
            }

            document.getElementById('customerForm').addEventListener('submit', function(event) {
                event.preventDefault();

                const customer = {
                    id: document.getElementById('customerId').value,
                    first_name: document.getElementById('first_name').value,
                    last_name: document.getElementById('last_name').value,
                    street: document.getElementById('street').value,
                    address: document.getElementById('address').value,
                    city: document.getElementById('city').value,
                    state: document.getElementById('state').value,
                    email: document.getElementById('email').value,
                    phone: document.getElementById('phone').value
                };

                const method = customer.id ? 'PUT' : 'POST';
                const url = customer.id ? `/api/customers/${customer.id}` : '/api/customers';

                fetch(url, {
                    method: method,
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': token
                    },
                    body: JSON.stringify(customer)
                })
                .then(response => {
                    if (response.ok) {
                        alert('Customer saved');
                        window.location.href = 'customers.html';
                    } else {
                        alert('Save failed');
                    }
                });
            });
        });
    </script>
</body>
</html>
